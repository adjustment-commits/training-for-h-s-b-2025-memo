<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lesson01 éª¨ç›¤ Ã— èƒ¸éƒ­ æ›¸ãè¾¼ã¿ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
<style>
  @page { size: A4 landscape; margin: 10mm; }
  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: #fff url("https://raw.githubusercontent.com/adjustment-commits/training-for-h-s-b-2025-memo/main/lesson01/A_pair_of_black_and_white_anatomical_line_drawings.png") no-repeat center;
background-size: contain;
    color: #111;
    text-align: center;
  }
  h1 {
    font-size: 18pt;
    color: #c33;
    margin: 10px 0;
  }
  #wrap {
    position: relative;
    width: 100%;
    max-width: 1000px;
    margin: 0 auto;
  }
  #baseImg {
    width: 100%;
    height: auto;
    user-select: none;
  }
  #drawCanvas {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    cursor: crosshair;
  }
  .btns {
    margin: 10px 0;
  }
  button {
    margin: 4px;
    padding: 8px 14px;
    font-size: 12pt;
    border: none;
    border-radius: 5px;
    background: #c33;
    color: #fff;
  }
  button:hover { opacity: 0.8; }
</style>
</head>
<body>

<h1>Lesson01ã€€éª¨ç›¤ Ã— èƒ¸éƒ­ æ›¸ãè¾¼ã¿ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>

<div id="wrap">
  <img id="baseImg" src="A_pair_of_black_and_white_anatomical_line_drawings.png" alt="éª¨ç›¤ã¨èƒ¸éƒ­ã®ç·šç”»">
  <canvas id="drawCanvas"></canvas>
</div>

<div class="btns">
  <button id="saveBtn">ğŸ’¾ ä¿å­˜</button>
  <button id="clearBtn">ğŸ§¹ æ¶ˆå»</button>
  <button id="downloadBtn">â¬‡ï¸ ç”»åƒã¨ã—ã¦ä¿å­˜</button>
</div>

<script>
const canvas = document.getElementById("drawCanvas");
const ctx = canvas.getContext("2d");
const img = document.getElementById("baseImg");

// Canvasã‚µã‚¤ã‚ºã‚’ç”»åƒã«åˆã‚ã›ã‚‹
function resizeCanvas() {
  canvas.width = img.clientWidth;
  canvas.height = img.clientHeight;
  loadSaved();
}
window.addEventListener("load", resizeCanvas);
window.addEventListener("resize", resizeCanvas);

let drawing = false;

canvas.addEventListener("pointerdown", e => {
  drawing = true;
  ctx.beginPath();
  const rect = canvas.getBoundingClientRect();
  ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
});
canvas.addEventListener("pointermove", e => {
  if (!drawing) return;
  const rect = canvas.getBoundingClientRect();
  ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
  ctx.strokeStyle = "#111";
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.stroke();
});
canvas.addEventListener("pointerup", () => drawing = false);
canvas.addEventListener("pointerleave", () => drawing = false);

// ä¿å­˜
document.getElementById("saveBtn").addEventListener("click", () => {
  localStorage.setItem("lesson01_canvas", canvas.toDataURL());
  alert("ä¿å­˜ã—ã¾ã—ãŸã€‚æ¬¡å›ã‚‚ã“ã®çŠ¶æ…‹ã‹ã‚‰å†é–‹ã§ãã¾ã™ã€‚");
});

// æ¶ˆå»
document.getElementById("clearBtn").addEventListener("click", () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  localStorage.removeItem("lesson01_canvas");
});

// å¾©å…ƒ
function loadSaved() {
  const saved = localStorage.getItem("lesson01_canvas");
  if (saved) {
    const img = new Image();
    img.src = saved;
    img.onload = () => ctx.drawImage(img, 0, 0);
  }
}

// ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
document.getElementById("downloadBtn").addEventListener("click", () => {
  const merged = document.createElement("canvas");
  merged.width = canvas.width;
  merged.height = canvas.height;
  const mctx = merged.getContext("2d");
  mctx.drawImage(document.getElementById("baseImg"), 0, 0, merged.width, merged.height);
  mctx.drawImage(canvas, 0, 0);
  const link = document.createElement("a");
  link.download = "lesson01_draw.png";
  link.href = merged.toDataURL();
  link.click();
});
</script>

</body>
</html>
